import{b as C,i as O,v as U,c as x}from"./v4.6627ac39.js";import{_ as z}from"./index.845bf1e2.js";import{d as B,C as u,M as F,N as P,O as $,K as j,L as J,m as L,A,P as M,Q as G,R as Y,B as K,S as Q,T as W,U as q,r as b,V as H,W as X,c as Z,a,h as t,w as n,G as ee,s as te,D as oe,i as r,F as ae,o as I,e as _,t as ne,p as se,b as le}from"./vendor.b7d6cc5d.js";import"./manifest.06f50b31.js";function N(e){switch(typeof e){case"string":return new Date(e).getTime();case"number":const o=new Date;o.setTime(e);const f=o.toLocaleDateString("zh-cn").split("/").map(v=>parseInt(v)<10?"0"+v:v).join("-"),h=o.toLocaleTimeString("zh-cn",{hour12:!1});return f+" "+h;default:throw new Error("EType")}}const ie=B({name:"RecordOverview",components:{ElMessage:u,ElDropdown:F,ElDropdownMenu:P,ElDropdownItem:$,ElTable:j,ElTableColumn:J,ElDialog:L,ElInput:A,ElInputNumber:M,ElRadioGroup:G,ElRadioButton:Y,ElButton:K,ElTag:Q,ElPagination:W},setup(){const e=()=>{h.value&&h.value.doLayout()};window.addEventListener("resize",e),q(()=>{window.removeEventListener("resize",e)});const o=oe("userState"),f=b(!1),h=b(null),v=b(1),S=b(1),p=b([]),c=b([]),E=H(()=>c.value.slice(v.value*30-30,v.value*30)),R=()=>{o.value.login?(f.value=!0,C(o.value.userToken).then(d=>{p.value=JSON.parse(JSON.stringify(d)),c.value=JSON.parse(JSON.stringify(d)),f.value=!1}).catch(d=>{d.toString()==="Error: ENotFound"?(u({type:"info",message:"This is the first login, the database will automatically created in few seconds"}),O(o.value.userToken).then(()=>{u({type:"info",message:"Database created successfully"}),f.value=!1}).catch(g=>{u({type:"error",message:g.toString()}),f.value=!1})):(u({type:"error",message:d.toString()}),f.value=!1)})):u({type:"info",message:"You are not logged in, please log in first"})};R();const m=d=>{const[g,w]=d.split(",");switch(g){case"reset":c.value=JSON.parse(JSON.stringify(p.value));break;case"value":c.value.sort((V,D)=>(parseFloat(V.value+"")-parseFloat(D.value+""))*(w==="asc"?1:-1));break;case"date":c.value.sort((V,D)=>(N(V.date)-N(D.date))*(w==="asc"?1:-1));break}},y=b(!1),i=X({value:0,date:N(Date.now()),flow:"IN",type:"",note:""});return{loading:f,tableRef:h,handleSort:m,newRecord:i,handleNew:d=>{if(d==="show")i.value=0,i.date=N(Date.now()),i.flow="IN",i.type="",i.note="",y.value=!0;else if(d==="create"){if(y.value=!1,i.value===0){u({type:"info",message:"Value cannot be 0"});return}if(!o.value.login){u({type:"info",message:"You are not logged in, please log in first"});return}const g={uuid:U(),value:i.value+"",date:i.date,flow:i.flow,type:i.type,note:i.note};u({type:"info",message:"Adding new record"}),x(o.value.userToken,g).then(()=>{u({type:"info",message:"Reloading record list"}),R()}).catch(w=>{u({type:"error",message:w.toString()})})}},newRecordDialogVisible:y,tableData:E,currentPage:v,totalPage:S}}}),l=e=>(se("data-v-16dcbd52"),e=e(),le(),e),de={id:"record-overview"},re={class:"overview-banner-container"},ce=l(()=>a("i",{class:"iconfont icon-sort"},null,-1)),ue=l(()=>a("span",{style:{"margin-left":"5px"}},"sort",-1)),pe=l(()=>a("i",{class:"iconfont icon-iconasc"},null,-1)),_e=_(" value"),fe=l(()=>a("i",{class:"iconfont icon-iconsort"},null,-1)),me=_(" value"),ve=l(()=>a("i",{class:"iconfont icon-iconasc"},null,-1)),we=_(" date"),ge=l(()=>a("i",{class:"iconfont icon-iconsort"},null,-1)),be=_(" date"),he=l(()=>a("i",{class:"iconfont icon-record"},null,-1)),ye=_(" reset"),Ve=l(()=>a("i",{class:"iconfont icon-filter-fill"},null,-1)),De=l(()=>a("span",{style:{"margin-left":"5px"}},"filter",-1)),Re=l(()=>a("i",{class:"iconfont icon-add"},null,-1)),Ne=l(()=>a("span",{style:{"margin-left":"5px"}},"new",-1)),Ee={class:"overview-table-container"},Se=_("Edit"),Te=_("Delete"),Ie={class:"new-record-dialog"},ke={class:"value"},Ce=l(()=>a("span",{class:"info-text"},"Value",-1)),Oe={class:"flow"},Ue=l(()=>a("span",{class:"info-text"},"Flow",-1)),xe={class:"date"},ze=l(()=>a("span",{class:"info-text"},"Date",-1)),Be={class:"type"},Fe=l(()=>a("span",{class:"info-text"},"Type",-1)),Pe={class:"note"},$e=l(()=>a("span",{class:"info-text"},"Note",-1)),je={class:"btn-group"},Je=_("Cancel"),Le=_("Create"),Ae={class:"overview-pager-container"};function Me(e,o,f,h,v,S){const p=r("el-button"),c=r("el-dropdown-item"),E=r("el-dropdown-menu"),R=r("el-dropdown"),m=r("el-table-column"),y=r("el-tag"),i=r("el-table"),T=r("el-input-number"),d=r("el-radio-button"),g=r("el-radio-group"),w=r("el-input"),V=r("el-dialog"),D=r("el-pagination"),k=ae("loading");return I(),Z("div",de,[a("div",re,[t(R,{onCommand:e.handleSort},{dropdown:n(()=>[t(E,null,{default:n(()=>[t(c,{command:"value,asc"},{default:n(()=>[pe,_e]),_:1}),t(c,{command:"value,desc"},{default:n(()=>[fe,me]),_:1}),t(c,{command:"date,asc"},{default:n(()=>[ve,we]),_:1}),t(c,{command:"date,desc"},{default:n(()=>[ge,be]),_:1}),t(c,{command:"reset,none",divided:""},{default:n(()=>[he,ye]),_:1})]),_:1})]),default:n(()=>[t(p,{type:"info",plain:""},{default:n(()=>[ce,ue]),_:1})]),_:1},8,["onCommand"]),t(p,{type:"info",plain:"",disabled:""},{default:n(()=>[Ve,De]),_:1}),t(p,{type:"info",plain:"",onClick:o[0]||(o[0]=s=>e.handleNew("show"))},{default:n(()=>[Re,Ne]),_:1})]),a("div",Ee,[ee((I(),te(i,{ref:"tableRef",data:e.tableData,height:"100%",border:"",stripe:"","empty-text":"No Record"},{default:n(()=>[t(m,{width:"50px",type:"index",label:"No.",fixed:"left"}),t(m,{width:"100px",prop:"value",label:"Value"}),t(m,{width:"200px",prop:"date",label:"Date"}),t(m,{width:"60px",label:"Flow"},{default:n(s=>[t(y,{type:s.row.flow==="IN"?"success":"danger"},{default:n(()=>[_(ne(s.row.flow==="IN"?"\u5165":"\u51FA"),1)]),_:2},1032,["type"])]),_:1}),t(m,{width:"150px",prop:"type",label:"Type"}),t(m,{prop:"note",label:"Note"}),t(m,{width:"100px",label:"Operate",fixed:"right"},{default:n(()=>[t(p,{type:"text",size:"small",disabled:""},{default:n(()=>[Se]),_:1}),t(p,{type:"text",size:"small",disabled:""},{default:n(()=>[Te]),_:1})]),_:1})]),_:1},8,["data"])),[[k,e.loading]]),t(V,{modelValue:e.newRecordDialogVisible,"onUpdate:modelValue":o[8]||(o[8]=s=>e.newRecordDialogVisible=s),width:"300px"},{default:n(()=>[a("div",Ie,[a("div",ke,[Ce,t(T,{class:"item-value",modelValue:e.newRecord.value,"onUpdate:modelValue":o[1]||(o[1]=s=>e.newRecord.value=s),type:"number"},null,8,["modelValue"])]),a("div",Oe,[Ue,t(g,{class:"item-value",modelValue:e.newRecord.flow,"onUpdate:modelValue":o[2]||(o[2]=s=>e.newRecord.flow=s)},{default:n(()=>[t(d,{label:"IN"}),t(d,{label:"OUT"})]),_:1},8,["modelValue"])]),a("div",xe,[ze,t(w,{class:"item-value",modelValue:e.newRecord.date,"onUpdate:modelValue":o[3]||(o[3]=s=>e.newRecord.date=s),disabled:""},null,8,["modelValue"])]),a("div",Be,[Fe,t(w,{class:"item-value",modelValue:e.newRecord.type,"onUpdate:modelValue":o[4]||(o[4]=s=>e.newRecord.type=s)},null,8,["modelValue"])]),a("div",Pe,[$e,t(w,{class:"item-value",modelValue:e.newRecord.note,"onUpdate:modelValue":o[5]||(o[5]=s=>e.newRecord.note=s)},null,8,["modelValue"])]),a("div",je,[t(p,{type:"info",onClick:o[6]||(o[6]=s=>e.newRecordDialogVisible=!1)},{default:n(()=>[Je]),_:1}),t(p,{type:"primary",onClick:o[7]||(o[7]=s=>e.handleNew("create"))},{default:n(()=>[Le]),_:1})])])]),_:1},8,["modelValue"])]),a("div",Ae,[t(D,{background:"",layout:"prev, pager, next","page-size":30,total:e.totalPage,"current-page":e.currentPage,"onUpdate:current-page":o[9]||(o[9]=s=>e.currentPage=s)},null,8,["total","current-page"])])])}var We=z(ie,[["render",Me],["__scopeId","data-v-16dcbd52"]]);export{We as default};
