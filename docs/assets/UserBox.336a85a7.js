import{g as w,v as b,a as S}from"./v4.6627ac39.js";import{_ as U}from"./index.87f993cf.js";import{d as B,m as C,A as h,B as T,r as p,C as l,D as $,i as f,F as I,o as y,c as V,G as A,a as _,t as x,h as c,w as d,e as g}from"./vendor.4ddb49f8.js";const D=B({name:"UserBox",components:{ElDialog:C,ElInput:h,ElButton:T},setup(){const o=$("userState"),e=p(!1),v=localStorage.getItem("userToken");!!v&&!o.value.login&&(e.value=!0,w().then(n=>{let s=n.find(a=>a.token===v);s?(l({type:"info",message:`Welcome Back, ${s.account}!`}),o.value={login:!0,account:s.account.slice(0,1).toUpperCase(),userToken:s.token}):localStorage.removeItem("userToken"),e.value=!1}).catch(n=>{e.value=!1,l({type:"error",message:n.toString()})}));const u=p(!1),r=p(""),i=p("");return{userState:o,loading:e,dialogVisible:u,account:r,password:i,doLogin:n=>{switch(n){case"show":r.value="",i.value="",u.value=!0;return;case"login":u.value=!1,(r.value.trim()===""||i.value.trim()==="")&&l({type:"info",message:"Account/Password cannot be empty"}),e.value=!0,w().then(a=>{let t=a.find(k=>k.account===r.value&&k.password===i.value);t?(localStorage.setItem("userToken",t.token),o.value={login:!0,account:t.account.slice(0,1).toUpperCase(),userToken:t.token},l({type:"info",message:`Welcome Back, ${t.account}!`})):l({type:"info",message:"Incorrect account or password, please try again"}),e.value=!1}).catch(a=>{e.value=!1,l({type:"error",message:a.toString()})});break;case"register":u.value=!1,(r.value.trim()===""||i.value.trim()==="")&&l({type:"info",message:"Account/Password cannot be empty"}),e.value=!0;const s={account:r.value,password:i.value,token:b()};S(s).then(()=>{localStorage.setItem("userToken",s.token),o.value={login:!0,account:s.account.slice(0,1).toUpperCase(),userToken:s.token},e.value=!1}).catch(a=>{e.value=!1,l({type:"error",message:a.toString()})});break}}}}}),E={id:"user-box"},L={class:"login-or-register-dialog"},j=g("\xA0Account\xA0"),N=g("Password"),P={class:"btn-group"},W=g("Sign Up"),F=g("Sign In");function G(o,e,v,u,r,i){const m=f("el-input"),n=f("el-button"),s=f("el-dialog"),a=I("loading");return y(),V("div",E,[A((y(),V("div",{class:"user-box-icon",onClick:e[0]||(e[0]=t=>o.doLogin("show")),"element-loading-background":"transparent"},[_("span",null,x(o.userState.login?o.userState.account:"?"),1)])),[[a,o.loading]]),c(s,{modelValue:o.dialogVisible,"onUpdate:modelValue":e[5]||(e[5]=t=>o.dialogVisible=t),width:"300px"},{default:d(()=>[_("div",L,[c(m,{modelValue:o.account,"onUpdate:modelValue":e[1]||(e[1]=t=>o.account=t)},{prepend:d(()=>[j]),_:1},8,["modelValue"]),c(m,{modelValue:o.password,"onUpdate:modelValue":e[2]||(e[2]=t=>o.password=t)},{prepend:d(()=>[N]),_:1},8,["modelValue"]),_("div",P,[c(n,{type:"info",onClick:e[3]||(e[3]=t=>o.doLogin("register"))},{default:d(()=>[W]),_:1}),c(n,{type:"primary",onClick:e[4]||(e[4]=t=>o.doLogin("login"))},{default:d(()=>[F]),_:1})])])]),_:1},8,["modelValue"])])}var H=U(D,[["render",G],["__scopeId","data-v-4f4f68f9"]]);export{H as U};
